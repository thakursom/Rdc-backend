# Enable Rewrite Engine
RewriteEngine On

# --- ALLOW DIRECT ACCESS TO UPLOADS ---
# If URL starts with /Rdc-backend/uploads -> send to Node (not Apache)
RewriteCond %{REQUEST_URI} ^/Rdc-backend/uploads/ [NC]
RewriteRule ^uploads/(.*)$ http://127.0.0.1:3000/uploads/$1 [P,L]

# --- EXISTING API PROXY ---
# Proxy all /api/ requests to Node
RewriteRule ^api/(.*)$ http://127.0.0.1:3000/api/$1 [P,L]

# Forward HTTPS info to Node
RequestHeader set X-Forwarded-Proto "https"
RequestHeader set X-Forwarded-Port "443"
RequestHeader set X-Forwarded-Host "%{HTTP_HOST}s"

# Disable caching for API endpoints
<IfModule mod_headers.c>
    <FilesMatch "^api/">
        Header always set Cache-Control "no-store, no-cache, must-revalidate, max-age=0, private"
        Header always set Pragma "no-cache"
        Header always set Expires "0"
    </FilesMatch>
</IfModule>

# Disable mod_cache (if enabled) for API endpoints
<IfModule mod_cache.c>
    CacheDisable /api/
</IfModule>

# Prevent proxies from caching API responses
<IfModule mod_proxy.c>
    Header always set Vary "Authorization,Accept-Encoding"
</IfModule>
