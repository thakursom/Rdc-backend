# Enable Rewrite Engine
RewriteEngine On

# -----------------------------
# 1. Proxy Uploads to Node
# -----------------------------
RewriteCond %{REQUEST_URI} ^/Rdc-backend/uploads/ [NC]
RewriteRule ^Rdc-backend/uploads/(.*)$ http://127.0.0.1:3000/uploads/$1 [P,L]

# -----------------------------
# 2. Proxy API requests to Node
# -----------------------------
RewriteCond %{REQUEST_URI} ^/Rdc-backend/api/ [NC]
RewriteRule ^Rdc-backend/api/(.*)$ http://127.0.0.1:3000/api/$1 [P,L]

# -----------------------------
# 3. Forward HTTPS headers
# -----------------------------
RequestHeader set X-Forwarded-Proto "https"
RequestHeader set X-Forwarded-Port "443"
RequestHeader set X-Forwarded-Host "%{HTTP_HOST}e"

# -----------------------------
# 4. Disable cache for API
# -----------------------------
<IfModule mod_headers.c>
    <Location "/Rdc-backend/api/">
        Header always set Cache-Control "no-store, no-cache, must-revalidate, max-age=0, private"
        Header always set Pragma "no-cache"
        Header always set Expires "0"
    </Location>
</IfModule>

